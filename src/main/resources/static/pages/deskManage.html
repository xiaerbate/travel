<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/my.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/my.css">
</head>
<body>
<div id="header"></div>
<div id="message"></div>
<div class="page-header" style="margin: 5% 0 2% 15%">
    <h1>团队管理
        <small>
            <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
                新增
            </button>
        </small>
    </h1>

</div>

<table class="table table-bordered text-center">
    <thead>
    <tr>
        <td>团队名</td>
        <td>人数上限</td>
        <td>操作</td>
    </tr>
    </thead>
    <tbody id="tbody">

    </tbody>

</table>

<div class="modal fade" tabindex="-1" role="dialog" id="myModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">新增团队</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="name">团队名</label>
                        <input type="text" class="form-control" id="name">
                    </div>
                    <div class="form-group">
                        <label for="size">可参与人数</label>
                        <input type="text" class="form-control" id="size">
                    </div>
                    <!--                    <button type="submit" class="btn btn-default">Submit</button>-->
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="addDesk()">提交</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" tabindex="-1" role="dialog" id="myModal2">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">编辑团队</h4>
            </div>
            <div class="modal-body">
                <form>
                    <input type="hidden" class="form-control" id="id2">
                    <div class="form-group">
                        <label for="name2">团队名</label>
                        <input type="text" class="form-control" id="name2">
                    </div>
                    <div class="form-group">
                        <label for="size2">人数上限</label>
                        <input type="text" class="form-control" id="size2">
                    </div>
                    <!-- <button type="submit" class="btn btn-default">Submit</button>-->
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="updateDesk()">提交</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" tabindex="-1" role="dialog" id="deleteModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">删除团队</h4>
            </div>
            <div class="modal-body">
                <input type="hidden" id="id3">
                <P>确定要删除吗？</P>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="deleteDesk()">确定</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


</body>
<script>
    $("#header").load('pages/header.html');
    function addDesk() {
        //拿输入框的值
        var name = $('#name').val();
        var size = $('#size').val();
        let param = {
            name: name,
            size: size
        };
        //发送请求
        myajax('post','desk',param,
            ()=>{
                queryDesk()
            }
        )
    }

    //页面加载完成后查询数据
    $(document).ready(
        queryDesk()
    )
    
    function queryDesk() {
        myajax('get','desk',null,
            res=>{
                $('#tbody').html('')
                $.each(res.data,function (k,v) {
                    $('#tbody').append(`
                        <tr>
                            <td>`+v.name+`</td>
                            <td>`+v.size+`</td>
                            <td>
                                <input class="btn btn-default" type="button" value="修改"
                                 onclick="openUpdate('`+v.name+`',`+v.size+`,`+v.id+`)">
                                <input class="btn btn-default" type="button" value="删除"
                                onclick="openDelete(`+v.id+`)">
                            </td>
                        </tr>
                    `)
                })
            }
        )
    }

    //打开模态框，把当前id存储到隐藏域的input
    function openDelete(deskId) {
        $('#deleteModal').modal('show')
        $('#id3').val(deskId)
    }

    //点击模态框的提交按钮后，触发这个函数，取到隐藏域的input输入框id的值，通过ajax请求发送到后端删除
    function deleteDesk() {
        let param = {
            id:$('#id3').val()
        }
        myajax('delete','desk',param,
            ()=>{
                $('#deleteModal').modal('hide')
                queryDesk()
            }
        )
    }

    //打开模态框，往模态框的输入框填值
    function openUpdate(name,size,id) {
        $('#name2').val(name)
        $('#size2').val(size)
        $('#id2').val(id)
        $('#myModal2').modal('show')
    }





    //点击模态框的提交按钮后，触发这个函数，取到用户更新后的输入框的值，通过ajax请求发送到后端更新
    function updateDesk() {
        let param = {
            id:$('#id2').val(),
            size:$('#size2').val(),
            name:$('#name2').val()
        }
        myajax('put','desk',param,
            ()=>{
                $('#myModal2').modal('hide')
                queryDesk()
            }
        )
    }

</script>
</html>