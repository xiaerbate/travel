<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/my.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/my.css">
    <style>
        #imga{
            height: 50px;
            width: 80px;
            margin: auto;
        }

    </style>
</head>
<body>
<div id="header"></div>
<div class="page-header" style="margin: 5% 0 2% 15%">
    <h1>活动内容
        <small>
            <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
                新增
            </button>
        </small>
    </h1>

</div>

<table class="table table-bordered text-center">
    <thead>
    <tr>
        <td>活动内容</td>
        <td>图片</td>
        <td>描述</td>
        <td>价格</td>
        <td>预计耗时(天)</td>
        <td>操作</td>
    </tr>
    </thead>

    <tbody id="tbody">

    </tbody>
</table>

<div class="modal fade" tabindex="-1" role="dialog" id="myModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">新增活动</h4>
            </div>
            <div class="modal-body">
                <form>

                    <div class="form-group">
                        <label for="name">内容</label>
                        <input type="text" class="form-control" id="name">
                    </div>
                    <div class="form-group">
                        <label for="picture">图片</label>
                        <input type="text" class="form-control" id="picture">
                    </div>
                    <div class="form-group">
                        <label for="description">活动描述</label>
                        <input type="text" class="form-control" id="description">
                    </div>
                    <div class="form-group">
                        <label for="price">价格</label>
                        <input type="text" class="form-control" id="price">
                    </div>
                    <div class="form-group">
                        <label for="time">时长</label>
                        <input type="text" class="form-control" id="time">
                    </div>
                    <!--                    <button type="submit" class="btn btn-default">Submit</button>-->
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="addDish()" data-dismiss="modal">提交</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" tabindex="-1" role="dialog" id="myModal2">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">编辑活动</h4>
            </div>
            <div class="modal-body">
                <form>
                    <input type="hidden" class="form-control" id="id2">
                    <div class="form-group">
                        <label for="name2">内容</label>
                        <input type="text" class="form-control" id="name2">
                    </div>
                    <div class="form-group">
                        <label for="picture2">图片</label>
                        <input type="text" class="form-control" id="picture2">
                    </div>
                    <div class="form-group">
                        <label for="description2">描述</label>
                        <input type="text" class="form-control" id="description2">
                    </div>
                    <div class="form-group">
                        <label for="price2">价格</label>
                        <input type="text" class="form-control" id="price2">
                    </div>
                    <div class="form-group">
                        <label for="time2">消耗时长</label>
                        <input type="text" class="form-control" id="time2">
                    </div>
                    <!--                    <button type="submit" class="btn btn-default">Submit</button>-->
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="updateDish()">提交</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" tabindex="-1" role="dialog" id="deleteModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">删除活动</h4>
            </div>
            <div class="modal-body">
                <P>确定要删除吗？</P>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick = "deleteDish()">确认</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
</body>
<script>
    $("#header").load('pages/header.html')

    $(document).ready(
        queryDish()
    )

    //新增菜单
    function addDish() {
        //拿输入框的值
        var name = $('#name').val();
        var picture = $('#picture').val();
        var description = $('#description').val();
        var price = $('#price').val();
        var time = $('#time').val();
        let param = {
            name: name,
            picture: picture,
            description: description,
            price: price,
            time: time,
        };
        //发送请求
        myajax('post','dish',param,
            ()=>{
                // $('#myModal').modal('hide')
                queryDish()
            }
        )
    }


    function queryDish() {
        myajax('get','dish',null,
            res=>{
                $('#tbody').html('')
                $.each(res.data,function (k,v) {
                    $('#tbody').append(`
                        <tr>
                            <td>`+v.name+`</td>
                            <td><img src="`+v.picture+`" class="img-responsive" id="imga"></td>
                            <td>`+v.description+`</td>
                            <td>`+v.price+`</td>
                            <td>`+v.time+`</td>
                            <td>
                                <input class="btn btn-default" type="button" value="修改"
                                 onclick="openUpdate(`+v.id+`,'`+v.name+`','`+v.picture+`','`+v.description+`',`+v.price+`,`+v.time+`)">
                                <input class="btn btn-default" type="button" value="删除"
                                onclick="openDelete(`+v.id+`)">
                            </td>
                        </tr>
                    `)
                })
            }
        )
    }


    function openUpdate(id,name,picture,description,price,time) {
        $('#id2').val(id)
        $('#name2').val(name)
        $('#picture2').val(picture)
        $('#description2').val(description)
        $('#price2').val(price)
        $('#time2').val(time)
        $('#myModal2').modal('show')
    }

    function updateDish() {
        let param = {
            id:$('#id2').val(),
            picture:$('#picture2').val(),
            description:$('#description2').val(),
            price:$('#price2').val(),
            time:$('#time2').val(),
            name:$('#name2').val()
        }
        myajax('put','dish',param,
            ()=>{
                $('#myModal2').modal('hide')
                queryDish()
            }
        )
    }

    var deleteid;

    function openDelete(id) {
        $('#deleteModal').modal('show')
        deleteid = id
    }

    function deleteDish() {
        let param ={
            id:deleteid
        }
        myajax('delete','dish',param,
            ()=>{
                $('#deleteModal').modal('hide')
                queryDish()
            }
        )
    }


</script>
</html>